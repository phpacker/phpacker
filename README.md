# PHPacker

Package any PHP script or PHAR into a standalone, cross-platform executable.

## Geting Started

You may install phpacker as a gloal or project dependency

```bash
composer global require phpacker/phpacker
```

Then run the `build` command to build your executables.

```bash
phpacker build --src=./app.php
```

## Digging deeper

### Output targets & config

By default you will be prompted through setting the basics. You may also pass these as arguments to the build command.

```bash
# builds mac-arm only
phpacker build mac arm --src=./app.php

# builds for all available platforms/architectures
phpacker build all --src=./app.php
```

#### Build path

You'll find your executables in `{src-dir}/build`. You can change this behavior using the `--dest=./custom-build-path` option.

#### INI definitions

PHPacker will scan your `src-dir` for a `phpacker.ini` file.
Alternatively you can pass a path `--ini=./../zonda.ini` or empty `--ini` to be prompted interactively.

#### PHP versions

PHPacker ships with precompiled binaries for `8.4`, `8.3` & `8.2`.
Provide the `--php=8.3` option to change the version your app uses.

Currently we provide binaries for the following architectures:

| Platform | Architectures |
| -------- | ------------- |
| mac      | arm, x64      |
| linux    | arm, x64      |
| windows  | x64           |

### Config file

Using a config file you are able to predefine any argument or option otherwise passed to the build command. This way you can have all parameters for your project in a single version tracked file.

```json
{
  "src": "./bin/app.phar",
  "dest": "./build",
  "ini": "./phpacker.ini",
  "platform": "all",
  "php": 8.4
}
```

By default, PHPacker will look for a `phpacker.json` file in `src-dir` if a `--src` option was passed. If you place the above config file in your project root you can simply run the build command without passing any arguments.

```bash
phpacker build
```

If you run the `build` command without any arguments it will check your current working directory. You may also provide a `--config` option pointing to the file.

The same applies for the `--ini` option.

## Custom PHP builds

PHPacker uses pre-built statically linked PHP binaries in order to enable cross-compilation. Custom binaries need to be built on the platforms they are intended for.

We aim to make this as simple as possible by providing a GitHub Workflow that generates these binaries.

To use your own, you need to:

- clone the [php-bin](https://github.com/phpacker/php-bin) repo
- update `php-extensions.txt` - See the [extension list](https://static-php.dev/en/guide/extensions.html) to see what's supported
- run the workflows, merge all pull requests & tag a release

To use your custom binaries, you need to set the repository URL. You can pass a repo directly as a command option.

```bash
phpacker build all --src=./app.php --repository='{org}/{user}/php-bin'
```

Recommended, however, is storing this option in the `phpacker.json` file. PHPacker will pick this up automatically during the build.

```json
{
  "repository": "{org}/{user}/php-bin"
}
```

### Updating the PHP binaries

The `build` command will check for updates automatically. If you wish, you can check for updates manually.

```bash
# update pre-built binaries
phpacker download
```

You may also update any binaries generated by a `phpacker/php-bin` compatible workflow.

```bash
# update any php-bin compatible repository
phpacker download "{org}/{user}/php-bin"
```
